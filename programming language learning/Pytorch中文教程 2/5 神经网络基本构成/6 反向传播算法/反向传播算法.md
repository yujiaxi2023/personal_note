反向传播建立于链式法则
![[Pasted image 20230526184832.png]]
输入经过隐藏层，输出层，最后计算loss
这个前向传播求导过程是
![[Pasted image 20230526184918.png]]

全连接层的链式法则公式
![[Pasted image 20230526185012.png]]
其中一个节点的链式法则的公式如图所示
需要注意的是x还需要经历激活函数才会变为下一层的输入
需要注意圈起来的wjk1的值只跟这一行连接起来的相关，所以后边的公式中只会出现Ok1和tk1的组合
这是针对于只有一层的全连接层，如果拓展这个网络到多层的全连接层

![[Pasted image 20230526191252.png]]
这里中间的就可能存在有多层的全连接层
可以称这一层的输入为xj层，经过一层激活函数后变为Oj层，其实是在同一层的数值
所以针对这一层的求参数的偏导的值为
![[Pasted image 20230526191531.png]]

如何从最后的loss function求偏导到前一层的参数wjk这一层中
这里求偏导的式子会发现只跟E 这一个loss function的前一层的输入Ok有关
这里的k对应的是wjk中的k
这里可以设一个中间量δKk 代表中间这一长串式子
![[Pasted image 20230526192004.png]]
为什么需要一个中间值，就是因为在前向传播中的这个中间值可以得到

然后再反向传播一层 从WK层传播到WJ层
![[Pasted image 20230526192217.png]]
知道这一层的传播方式就可以自然了解往后接着传播是什么方式进行
![[Pasted image 20230526192351.png]]
因为这里的E 也就是loss function的式子已经知道采用的是均方误差函数
也就是最上边的最后输出的结果Ok 和 实际的标签值tk的差值求平方 求和再求二分之一
根据链式法则一层层的往前，想把求和符号外的1/2带入式子中
首先OK层的往前是激活函数的xK层
![[Pasted image 20230526192812.png]]
把激活函数的xK层进行求积分
根据公式可以展开为
![[Pasted image 20230526192941.png]]
这就完整的变为了xK层对于前面的参数求积分
xK层前一层是OJ层，所以可以继续传播
![[Pasted image 20230526193234.png]]
然后继续写入已知的偏导数结果
![[Pasted image 20230526193707.png]]
继续是将激活函数的式子带入
![[Pasted image 20230526193812.png]]
再将xj对于wij进行求导的结果带入
![[Pasted image 20230526193923.png]]
就是最终的结果
![[Pasted image 20230526194056.png]]

如果没有最开始的输入层，只有最后两层的全连接层
![[Pasted image 20230526194129.png]]
推到出的式子为
![[Pasted image 20230526194144.png]]
如果前面添加一层输入层，就需要添加一个固定的表达式
![[Pasted image 20230526194234.png]]
![[Pasted image 20230526194245.png]]
所以最后的结果为
![[Pasted image 20230526194259.png]]
可以按上面的δ简化方式进行简化
![[Pasted image 20230526194554.png]]
所以所有的都可以进行这种替换，因为输入不一定的，后边的信息都是固定的，只要是参数确定的情况
