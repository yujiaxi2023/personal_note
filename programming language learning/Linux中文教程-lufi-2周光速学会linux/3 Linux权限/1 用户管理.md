Linux服务器可以由多个用户同时进行操作
![[Pasted image 20240315220546.png]]

各自可以进行各自的操作
用户权限控制就是来避免删库跑路等操作

### linux用户管理

类似于qq群,里面有群主,管理员,群员等不同的权限类型

root用户 普通用户 sudo命令的区别

```shell
useradd xiaozhang
```
![[Pasted image 20240315220756.png]]
```
/home/ 同一的普通用户家目录
/home/yu/
/home/xiaozhang/
```

"组"是相似权限的多个用户的集合

Linux中引入了UID和GID的概念
user identify 和group identify
用户的UID是唯一的,当UID是0的时候就是root用户
系统用户的UID就是1-999之间,是linux的服务程序自动创建的用户
普通用户UID是从1000开始,root创建的
```shell
tail -5 /etc/passwd
```

### 用户组group

可以针对部门设定权限

#### 用户和组的关系

- 一对一, 一个用户可以在一个组
- 一对多, 一个用户多个组
- 多对一, 多个用户一个组
- 多对多, 多个用户多个组

### 常用命令解释器
```
/bin/sh 默认
/bin/bash 默认
/sbin/nologin 虚拟用户
/dash ubuntu
csh unix
tsh unix
```

一般用到的就是sh和bash解释器

### 用户信息配置文件
`/etc/passwd文件内容`
![[Pasted image 20240315221354.png]]

```shell
useradd 用户名  # 创建用户的时候会同时创建一样名字的用户组
# 用户指定了/bin/bash解释器,代表可以登录机器进行命令翻译
# /sbin/nologin就是禁止登录机器
```

### 用户管理的命令

| 命令       | 作用              |
| -------- | --------------- |
| useradd  | 创建用户            |
| usermod  | 修改用户及配置文件       |
| passwd   | 更改用户密码          |
| chpasswd | 批量更新用户密码        |
| change   | 修改用户密码属性        |
| id       | 查看用户UID,GID,组信息 |
| su       | 切换用户            |
| sudo     | 用root身份执行命令     |
| visudo   | 编辑sudoers配置文件   |
用户创建家目录的过程
```shell
1. 命令创建
useradd chaoge # 默认在/etc/passwd, 生成用户家目录/home/chaoge
ls -a # 显示home下的隐藏内容

2. 系统把/etc/skel目录下的内容复制到创建的用户家目录
rm -rf /home/chaoge
mkdir /home/chaoge
cp /etc/skel/.bash* /home/chaoge
su - chaoge # 这样可以在删除了家目录之后也可以恢复损坏用户

3. 更改用户密码
passwd chaoge

4. -c 用户注释
useradd chaoge -c<备注文字>
```

```
-c<备注>  添加备注文字,备注文字会保存在passwd备注栏位上
-d<登入目录> 指定用户登入时候的启示目录
-D 变更预设值
-e<有效期限> 指定找好的有效期限
-f<缓冲天数> 指定在密码过期后多少天关闭该账号
-g<群组> 指定用户所属的群组
-G<群组> 指定用户所属的附加群组
-m 自动建立用户的登入目录
-M 不要自动建立用户的登入目录
-n 取消建立以用户名称为名的群组
-r 建立系统账号
-s<shell> 指定用户登入后所使用的shell
-u<uid> 指定用户id
```

### 创建用户流程

- 1. useradd chaoge
- 2. 系统读取/etc/login.defs(用户定义文件), 和/etc/default/useradd(用户默认配置文件)两个文件中定义的规则创建新用户
- 3. 向/etc/passwd和/etc/group文件中添加用户和组信息, 向/etc/shadow和/etc/gshadow中添加密码信息
- 4. 根据/etc/default/useradd 文件中配置的信息创建用户家目录
- 5. 把/etc/skel中所有的文件复制到新用户家目录中

文件/etc/login.defs

```
grep -v "^#" /etc/login.defs | grep -v "^$"

MAIL_DIR	/var/spool/mail
PASS_MAX_DAYS	99999
PASS_MIN_DAYS	0
PASS_MIN_LEN	5
PASS_WARN_AGE	7
UID_MIN                  1000
UID_MAX                 60000
SYS_UID_MIN               201
SYS_UID_MAX               999
GID_MIN                  1000
GID_MAX                 60000
SYS_GID_MIN               201
SYS_GID_MAX               999
CREATE_HOME	yes
UMASK           077
USERGROUPS_ENAB yes
ENCRYPT_METHOD SHA512
```

文件/etc/default/useradd
```
grep -v "^#" /etc/default/useradd | grep -v "^$"

GROUP=100
HOME=/home
INACTIVE=-1
EXPIRE=
SHELL=/bin/bash
SKEL=/etc/skel
CREATE_MAIL_SPOOL=yes
```
这个文件定义的创建用户的设定

### 创建用户相关的目录/etc/skel

此目录存放新用户需要的基础环境变量文件,添加新用户的时候, 这个目录下面所有的文件都自动复制到新家目录下,并且默认是隐藏文件,用点开头
```
ls -la /etc/skel/
total 24
drwxr-xr-x.  2 root root   62 Dec 17 20:12 .
drwxr-xr-x. 80 root root 8192 Mar 14 23:15 ..
-rw-r--r--.  1 root root   18 Apr  1  2020 .bash_logout
-rw-r--r--.  1 root root  193 Apr  1  2020 .bash_profile
-rw-r--r--.  1 root root  231 Apr  1  2020 .bashrc
```

### id命令
```shell
id 用户名 # 查看用户信息
id chaoge
```

### groupadd命令
```shell
groupadd yunwei
tail /etc/group
```
这里可以查看组的GID信息

```shell 
useradd yu -M -s</sbin/nologin> # 这样这个用户就会不一样,而且进入不了
```

### usermod命令

用于修改系统已经存在的用户信息
```
语法
usermod [选项] [参数]

选项
-c<备注> 修改用户账号的备注文字
-d<登入目录> 修改用户登入时候的目录
-e<有效期限> 修改账号的有效期限
-f<缓冲天数> 修改在密码过期多少天后关闭账号
-g<群组> 修改用户所属的群组
-G<群组> 修改用户所属的附加群组
-l<账号名称> 修改用户账号名称
-L 锁定用户密码让密码无效
-s<shell> 修改用户登入时候使用的shell
-u<uid> 修改用户uid
-U 解除密码锁定
```

案例
```shell
usermod -u 1500 -s /bin/bash -c myself-user -G old -e "2025/10/10" -f 10 -d /home/luffychao yu
```

### userdel命令
删除用户和相关文件
- 建议注释/etc/passwd用户信息而不是直接删除用户
```
语法
userdel [选项] [参数]

选项
-f 强制删除用户,即使用户已经登录
-r 删除用户的同时,删除和用户相关的所有文件
```

案例
```
userdel oldyu
userdel -rf oldchao
```

### 批量更新密码

```shell
chpasswd
yu:123
yu1:456
yu2:123

su - yu

su - yu1
```

### whoami, w, who, last, lastlog

```shell
whoami # 查看当前目录
```

```shell
w # 查看有多少终端登录
```

```shell
who # 显示更全的w信息
```

### linux用户身份切换命令

### su命令

su命令用于切换到指定用户

```
语法
su [选项] [参数]

选项
-c<指令>, --command=<指令> 执行完指定的指令后,恢复原来的身份
-f, --fast 适用于csh或者tsch,让shell不用去读取启动文件
-l, --login 改变身份,同时变更工作目录,以及HOME,SHELL,USER,logname,也会变更$PATH变量
-m, -p, --preserve-environment 变更身份的时候不变环境变量
-s<shell>, --shell=<shell> 指定要执行的shell
--help 显示帮助
--version 显示版本信息
```

案例

第一种方法: su 用户名
这种方法不好因为不会切换环境变量
```shell
su yu
env | grep "USER|MAIL|PWD|LOGNAME"
```

第二种方法: su - 用户名
这种会变换环境变量


### sudo命令

使用sudo需要输入用户密码
然后需要在sudoers的名单中

```shell
visudo
```
在找到root相关的内容
然后编辑添加sudoer名单