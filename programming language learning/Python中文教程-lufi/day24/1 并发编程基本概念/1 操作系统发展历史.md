## 并发编程

是一项庞大复杂的技术

## 基本概念

### 操作系统发展史

#### 史前时代

##### 手工操作——穿孔卡片

1946年第一台计算机诞生--20实际50年代中期，计算机工作还在采用手工操作的方式。此时没有操作系统概念，属于第一代计算机

程序员对应于程序和数据的穿孔卡片（punched card，就是一张纸卡片，这个纸卡片分为N行M列的格子）装入输入机，然后启动输入机把程序和数据输入计算机内存，接着通过控制台开关启动程序针对数据运行；计算完毕，打印机输出计算结果；用户取走结果并卸下纸带（或者卡片）后，才让下一个用户上机。

手工操作方式3个特点：

1. 一个用户独占全集。不会出现资源被其他用户占用而等待的现象，但是资源利用率很低。
2. CPU等待用户手工录入输入，这个等待过程中，CPU并没有工作或者利用上
3. 同一时刻只有一个程序在内存中被CPU调用运行（串行的）

因为当时的计算机非常昂贵，所以都希望更高效的使用计算机完成工作任务。所以20世纪50年代后期，随着计算机的推广，人机矛盾就非常尖锐，手工操作的慢速度和计算机的高速度之间形成了尖锐矛盾，手工操作方式已经严重损害了系统资源的利用率（使资源利用率降到百分之几，甚至更低），所以考虑CPU利用率问题。唯一的解决方法：拜托人的手工操作，实现作业的自动过度。这样出现了批处理系统，计算机发展进入第二代计算机时代

##### 批处理系统——磁带储存

批处理系统，加载在计算机上的一个系统软件，在它的控制下，计算机可以自动地，成批的处理一个或者多个用户的作业（包括程序，数据和命令）

###### 联机批处理系统

最先出现的是联机批处理系统，就是作业的输入/输出由CPU来处理
![[Pasted image 20231207170602.png]]
主机和输入机之间增加一个储存设备——磁带，在运行于主机上的监督程序的自动控制下，计算机可自动完成：成批的把输入机上的用户作业读入磁带，然后依次将磁带上的用户作业读入主机内存并执行并把计算结果向输出机输出。完成了上一批作业之后，监督程序又从输入机上输入另一批作业，保存在磁带上，并按照上述步骤重复处理。

监督程序不停地处理各个作业，从而实现了作业到作业的自动转接，减少了作业建立时间和手工操作。

但是作业输入和结果输出的时候，主机的告诉CPU还是在空闲状态，等待慢速的输入/输出设备完成工作：主机出于“忙等”状态。

###### 脱机批处理系统

为了克服高速主机和慢速外设的矛盾，提高CPU的利用率，又引入了脱机批处理系统，就是输入/输出脱离主机控制

![[Pasted image 20231207171246.png]]

![[Pasted image 20231207175711.png]]

卫星机：是一台和主机不直接相连而是专门用来跟输入/输出设备打交道的，功能是：
1. 从输入机上读取用户作业并放到输入磁带上。
2. 从输出磁带上读取执行结果并传给输出机。

这样，主机并不是直接和慢速的输入/输出设备打交道，而是和速度相对较快的磁带机发生关系，有效缓解了主机和设备的矛盾，主机和卫星机可以并行工作，二者分工明确，额可以充分发挥主机的高速计算能力。

脱机批处理系统：20世纪60年代应用非常广泛，它极大缓解了人际矛盾和主机和外设的矛盾

但仍然有不足的地方：每次主机内存中仅仅存放一道作业，每当它运行期间发出输入/输出（I/O）请求后，告诉的CPU便出于等待低速的I/O完成的状态，导致CPU空闲

所以为了进一步改善利用率，出现了多道程序系统（第一次出现了操作系统的概念），计算机的发展进入到第三代计算机的时代

###### 多道系统

CPU执行任务的过程中，如果需要操作硬盘，就发送操作磁盘的指令，指令一旦发出，硬盘上的机械手臂滑动读取数据到内存中，这段时间CPU需要等待，这个时间虽短，但是cpu已经可以完成很多任务了，所以我们产生了多道技术（多道程序设计技术）

###### 多道程序设计技术

所谓多道程序设计技术，就是多个程序进入到内存中进行运行，当一个程序因为IO请求暂停运行的时候，CPU就会去运行另一道程序
![[Pasted image 20231207181043.png]]
A程序计算的时候 IO空闲，所以可以读取B程序，当A的IO操作的时候 CPU空闲，可以进行B程序计算，所以两者是串行运行的

![[Pasted image 20231207180608.png]]
同一时间内，计算机可以运行多个应用程序，IO和CPU是两个不同的设备
![[Pasted image 20231207180710.png]]
操作系统完成了我们的CPU和IO多道计算的程序切换

多道技术可能有个问题：
如果程序只需要计算，不需要进行输出。

###### 短作业优先算法

比较两个任务量，像这里可能老教授的任务是10小时运行时间，而研究生只需要5min，这时候老教授会让研究生先运行，但是这个因为遵循的是严格的大小比较策略，所以可能会造成老教授一直无法进行作业的困境
![[Pasted image 20231207181423.png]]

###### 时间分片
![[Pasted image 20231207181534.png]]
这时候采用的方法是时间分片，比如，按照输入任务的顺序，先让老教授的 运行5min，然后研究生5min，小年轻5min，这样往复循环的进行计算可以解决上面的问题

###### 数据混淆

会不会出现大家数据都在内存中，所以读取的时候混乱了？
非常可能

###### 内存隔离

如输入的是多个任务，就会在内存中进行内存隔离

多道运算解决了cpu的运行利用率问题

单处理机系统中多道程序运行的特点：
1. 多道：计算机内存中同时存放又几道相互独立的程序
2. 宏观上并行：同时进入系统的几道程序都是出于运行过程中，就是它们先后开始了各自的运行，但是都没有运行完成
3. 微观上串行：实际上，各道程序轮流使用CPU，交替进行计算

多道程序系统的出现，标志着操作系统逐渐成熟的阶段，先后出现了作业调度管理（时间隔离，短作业优先算法+先来先服务算法），处理机管理，储存器管理（实现空间隔离），外部设备管理，文件系统管理等功能

由于多个程序同时运行，所以内存上必须要进行空间隔离，才能让数据安全稳定的运行

多道技术还第一次体现了时空复用的特点，遇到IO操作就切换程序，让效率提高，此时是第三代计算机时代

###### 分时系统

计算机进入到了第四代计算机时代，由于CPU速度不断地提高并且采用分时技术，一台计算机可以连接多个用户终端，每个用户可以在自己的终端上联机使用计算机，就如同自己独占机器一样。

分时技术：把处理及的运行时间分成很短的时间片，按照时间片轮流把处理机分配给各联机作业使用

如果某个作业在分配给它的时间片内不能完成其计算，那么这个作业暂时中断，把处理机让给另一个作业使用，等待下一个轮时进行计算，由于计算机速度很快，所以作业运行的轮转很快，给每个用户的印象就好像是独占了一台计算机，每个用户可以通过自己的终端向系统发出各种操作控制命令，在充分的人机交互的情况下，完成作业的运行

具有上述特征的计算机系统称为分时系统：
1. 多路性：若干个用户同时使用同一台计算机，微观上看是各个用户轮流使用计算机；宏观上是用户在并行工作
2. 交互性：用户可以根据系统对请求的响应结果，进一步向系统提出新的请求。这种可以让用户和系统进行人机对话的方式，有别于批处理系统，因此，分时系统也称为交互式系统
3. 独立性：用户之间可以相互独立操作，互不干扰，系统保证个用户程序运行的完整性，不会发生相互混淆或者破坏现象。
4. 及时性：系统可以对用户的输入及时做出响应。分时系统性能的主要指标之一是响应时间，它是指：从终端发出命令到系统予以应答需要的时间

分时系统的主要目标：对用户响应的及时性，不至于让用户等待每一个命令的处理时间过长

分时系统可以同时接纳是个上百个用户，因为内存空间优先，采用对换（也称为交换）的储存方式。将未轮到的作业放入磁盘，一旦轮到了，将其调入到内存中，如果时间片用完之后，又会将作业存储到磁盘中（俗称滚进，滚出发），使得同一个储存区域轮流为多个用户服务。

多用户分时系统是当今计算机操作系统中最普遍使用的一类操作系统。

注意：分时系统的分时间片工作，在没有遇到IO擦欧总的时候就用完了自己的时间片被窃走了，这样切换工作没有提高cpu效率，反而让计算效率更低了，比如我原本5分钟的任务因为需要等待别人的运行所以会需要多等待一些时间。

###### 分时系统的弊端

因为分时系统是将程序分为时间片，在时间片结束或者IO阻塞之前是不会切换的，而CPU中都是以毫秒为级别的时间片，但是这对于一些实时控制要求是无法达到的。

因此就产生了实时系统，系统可以及时响应随即发生的外部事件，并在严格的时间范围内对该事件进行处理

实时系统可以在一个特定的应用中常作为一种控制设备来使用

实时系统可以分为两类：
1. 实时控制系统。用于飞机飞行导弹发射等自动控制，要求计算机能够尽快处理测量系统获得的数据，即使对导弹飞机进行控制，或者将有关信息通过显示终端提供给决策人员。当进行轧钢，石化等生产过程控制的时候，也要求计算机能够及时处理由各类传感器送来的数据，然后控制相应的执行机构
2. 实时信息处理系统。预定机票，查询航班，银行系统，情报检索系统都需要计算机对终端设备发来的服务请求给与正确的回答，此类对响应及时性能的要求稍弱于第一类

实时操作系统的主要特点：
1. 及时响应，每一个信息接收，分析处理和发送的过程都必须在严格的时间限制内完成
2. 高可靠性，采取冗余措施，双机系统在前后台进行工作，也包括必要的保密措施等

```
分时：
现在流行的服务器都是采用这种运行模式，把CPU的运行分成若干个时间片分别处理不同的运算请求
linux系统

实时：
一般用于单片机，PLC等，比如电梯上下控制等等
```

###### 通用操作系统

操作系统分为三种基本类型：多道批处理系统，分时系统，实时系统

通用操作系统：具有多种类型操作特征的操作系统，可以同时兼有多道批处理，分时，实时处理的功能，或者其中两种以上的功能

例如：实时处理+批处理=实时批处理系统，首先保证优先处理实时任务，插空处理批处理作业。常把实时任务称为前台作业，批作业称为后台作业。

如：分时处理+批处理=分时批处理系统，对时间要求不强的作业放入“后台”批处理进行处理，需要频繁交互的作业放在“前台”分时进行处理，处理机优先处理前台作业

unix操作系统是一个通用的多用户分时交互性的操作系统，首先建立的是一个精干的核心，功能和很多大型操作系统相媲美，核心层之外可以支持庞大的软件系统，很快就得到了应用和推广

##### 操作系统的进一步发展

20世纪80年代，大规模集成电路工艺发展，微处理机出现了掀起了计算机革命，迎来了个人的计算机时代，又向计算机网络，分布式处理，巨型计算机和智能化方向，进一步发展得到：个人计算机操作系统，网络操作系统，分布式操作系统等

###### 个人计算机操作系统

个人计算机上的操作系统是联机交互的单用户操作系统，提供的是来脑机交互功能和通用分时系统提供的功能是相似的
提供更友好方便的用户接口和丰富功能的文件系统的要求会越来越迫切

###### 网络操作系统

计算机网络：通过通信设施，将地理上分散的，具有多个自治功能的计算机系统相互连接起来，实现信息交换，资源共享，互操作和协作处理的系统

网络操作系统：在原来各个操作系统上，按照网络体系结构的各个协议标准增加网络管理模块，包括：通信，资源共享，系统安全和各种网络应用服务

###### 分布式操作系统

表面上看，分布式系统和计算机网络系统没有多少区别，分布式操作系统也是通过通信网络，将地理上分散的具有自治功能的数据处理系统或者计算机系统互连，实现信息交换和资源共享，协作完成任务--硬件连接相同

但是又有一些区别：
1. 分布式系统要求一个统一的操作系统，实现操作系统的统一性
2. 分布式操作系统管理分布式系统中的所有资源，负责全系统的资源分配和调度，任务划分，信息传输和控制协调工作，并为用户提供一个统一的界面
3. 用户通过这一界面，实现所需要的操作也使用系统资源，至于操作定在哪台计算机进行执行，或者使用哪台计算机的资源，是由操作系统完成的，用户不必知道，叫做系统的透明性
4. 分布式系统更强调分布式计算和处理，因此对于多机合作和系统重构，坚强性和容错能力都有更高的要求，希望系统有：更短的响应时间，高吞吐量和高可靠性。