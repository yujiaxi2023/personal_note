## 3 搜索和替换

- /pattern 向后搜索字符串pattern # 辅助n和N
- ?pattern 向前搜索字符串pattern # 辅助n和N
- :%s/old/new/g 搜索整个文件，将所有的old替换为new
- :%s/old/new/gc 搜索整个文件，将所有的old替换为new，每次都要你确认是否替换

#### 搜索功能
```
/3306 # 就可以查找到3306
```
![[Pasted image 20231215203033.png]]
使用n之后达到最后一个3306会变红
![[Pasted image 20231215202949.png]]
使用N就会向上搜索

```
?ssh
```
![[Pasted image 20231215203147.png]]
这个时候使用n就是向上继续搜索
使用N就是向下
N其实就是作相反命令的感觉，比如说/ssh变为?ssh
n就是作相同命令，/ssh还是/ssh

#### 替换功能

##### 替换指定的行
```
# 比如我要替换416行
416 mysql           3306/tcp                        # MySQL
417 mysql           3306/udp                        # MySQL
```
```
416s/mysql/MYSQL/g
416,417s/mysql/MYSQL/g
```
然后就替换成功了，可以替换多行

如果替换很多行
```
400,425s#tcp#TCP#g
```
这里就是替换从400到425的所有的内容
###### **,** 代表的是从哪一行到哪一行
###### $代表行尾，可以从输入的行一直替换到行尾


##### 全文替换
```
%s#tcp#TCP#g
```
会在最下面显示替换了多少处和多少行

###### 支持替换的时候检查
```
%s#tcp#TCP#gc
```
![[Pasted image 20231215204023.png]]
yes no all quit

###### 数字键盘上所有键都可以作为分隔
```
!@#$%^&*/
```
/有点不好就是在替换路径的时候不合适
所以#是比较合理的

## 4 退出编辑器：

- :w 将缓冲区写入文件，即保存修改
- :wq 保存修改并退出
- :x 保存修改并退出
- :q 退出，如果对缓冲区进行过修改，则会提示
- :q! 强制退出，放弃修改


## 删除指定个字符

dw 删除字符
x 删除单个字符
10x 删除10个字符

[史上最全Vim快捷键键位图（入门到进阶） | 菜鸟教程 (runoob.com)](https://www.runoob.com/w3cnote/all-vim-cheatsheat.html)

其实不会这个也没事情
使用xftp拖到window里面修改就行了
vi适用于非常大的文件只需要改几行的情况下使用


## 文件的修改原理

当我们进入到vi界面修改文件的时候
这时候会创建一个隐藏文件
![[Pasted image 20231215205227.png]]
这里以修改services为例

文件本来是储存在硬盘中
如果要修改文件，就需要先从硬盘加载到内存
vim因为会防止你的文件因为断电丢失，所以会在硬盘中创建一个会自动保存的隐藏文件
- 如果我要撤销，我使用强制退出，就会删除掉这个临时文件
- 如果我选择保存，就会删除掉原来的文件，将这个隐藏文件变为这个新的文件（重命名）

如果正常退出，隐藏文件就会删掉
如果不正常退出，如果不小心掉线了，这种不正常退出，有两种情况：
- 并没有对源文件进行修改，swp文件会自动删除
- 对源文件修改了，swp文件会继续存在
![[Pasted image 20231215205801.png]]
这时候重新打开的时候会显示这个内容
会告诉你是否是要恢复，或者是删除这个隐藏文件
![[Pasted image 20231215205840.png]]

有多种情况，掉线是一种，但是也有可能是别人也在进行编辑
如果服务器正在多人使用，你最好使用read only进行只读，否则，多人编辑容易出现混乱
![[Pasted image 20231215210052.png]]
